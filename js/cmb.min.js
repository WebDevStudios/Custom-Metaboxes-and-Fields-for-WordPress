window.CMB=function(window,document,$,undefined){"use strict";var l10n=window.cmb_l10,setTimeout=window.setTimeout,cmb={formfield:"",idNumber:!1,file_frames:{},repeatEls:'input:not([type="button"]),select,textarea,.cmb_media_status',defaults:{timePicker:l10n.defaults.time_picker,datePicker:{showAnimType:"fadeIn",showButtonPanel:!0,dateFormat:l10n.dateFormat,dayNames:eval("["+l10n.dayNames+"]"),dayNamesMin:eval("["+l10n.dayNamesMin+"]"),dayNamesShort:eval("["+l10n.dayNamesShort+"]"),monthNames:eval("["+l10n.monthNames+"]"),monthNamesShort:eval("["+l10n.monthNamesShort+"]"),nextText:l10n.nextText,prevText:l10n.prevText,currentText:l10n.currentText,closeText:l10n.closeText,clearText:l10n.clearText},colorPicker:l10n.defaults.color_picker||{}}};return cmb.metabox=function(){return cmb.$metabox?cmb.$metabox:(cmb.$metabox=$("table.cmb_metabox"),cmb.$metabox)},cmb.init=function(){var e=cmb.metabox(),t=e.find(".repeatable-group");l10n.new_admin_style&&e.find(".cmb-spinner img").hide(),cmb.initPickers(e.find("input:text.cmb_timepicker"),e.find("input:text.cmb_datepicker"),e.find("input:text.cmb_colorpicker")),$("#ui-datepicker-div").wrap('<div class="cmb_element" />'),$('<p><span class="button cmb-multicheck-toggle">'+l10n.check_toggle+"</span></p>").insertBefore("ul.cmb_checkbox_list"),cmb.makeListSortable(),e.on("change",".cmb_upload_file",function(){cmb.formfield=$(this).attr("id"),$("#"+cmb.formfield+"_id").val("")}).on("click",".cmb-multicheck-toggle",cmb.toggleCheckBoxes).on("click",".cmb_upload_button",cmb.handleMedia).on("click",".cmb_remove_file_button",cmb.handleRemoveMedia).on("click",".add-group-row",cmb.addGroupRow).on("click",".add-row-button",cmb.addAjaxRow).on("click",".remove-group-row",cmb.removeGroupRow).on("click",".remove-row-button",cmb.removeAjaxRow).on("keyup paste focusout",".cmb_oembed",cmb.maybeOembed).on("cmb_remove_row",".repeatable-group",cmb.resetTitlesAndIterator),t.length&&t.filter(".sortable").each(function(){$(this).find(".remove-group-row").before('<a class="shift-rows move-up alignleft" href="#">'+l10n.up_arrow+'</a> <a class="shift-rows move-down alignleft" href="#">'+l10n.down_arrow+"</a>")}).on("click",".shift-rows",cmb.shiftRows).on("cmb_add_row",cmb.emptyValue),setTimeout(cmb.resizeoEmbeds,500),$(window).on("resize",cmb.resizeoEmbeds)},cmb.resetTitlesAndIterator=function(){$(".repeatable-group").each(function(){var e=$(this);e.find(".repeatable-grouping").each(function(t){var i=$(this);i.data("iterator",t),i.find(".cmb-group-title h4").text(e.find(".add-group-row").data("grouptitle").replace("{#}",t+1))})})},cmb.toggleCheckBoxes=function(e){e.preventDefault();var t=$(this),i=t.parents("td").find("input[type=checkbox]");t.data("checked")?(i.prop("checked",!1),t.data("checked",!1)):(i.prop("checked",!0),t.data("checked",!0))},cmb.handleMedia=function(e){if(wp){e.preventDefault();var t=cmb.metabox(),i=$(this);cmb.formfield=i.prev("input").attr("id");var r=$("#"+cmb.formfield),a=r.attr("name"),n=!0,o=!0,c=i.hasClass("cmb_upload_list");if(cmb.formfield in cmb.file_frames)return void cmb.file_frames[cmb.formfield].open();cmb.file_frames[cmb.formfield]=wp.media.frames.file_frame=wp.media({title:t.find("label[for="+cmb.formfield+"]").text(),button:{text:l10n.upload_file},multiple:c?!0:!1});var m={list:function(e){o=e.toJSON(),r.val(o.url),$("#"+cmb.formfield+"_id").val(o.id);var t=[];$(o).each(function(){n=this.type&&"image"===this.type?'<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'"><p><a href="#" class="cmb_remove_file_button" rel="'+cmb.formfield+"["+this.id+']">'+l10n.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" name="'+a+"["+this.id+']" value="'+this.url+'"></li>':"<li>"+l10n.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+l10n.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+cmb.formfield+"["+this.id+']">'+l10n.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" name="'+a+"["+this.id+']" value="'+this.url+'"></li>',t.push(n)}),$(t).each(function(){r.siblings(".cmb_media_status").slideDown().append(this)})},single:function(e){o=e.first().toJSON(),r.val(o.url),$("#"+cmb.formfield+"_id").val(o.id),n=o.type&&"image"===o.type?'<div class="img_status"><img style="max-width: 350px; width: 100%; height: auto;" src="'+o.url+'" alt="'+o.filename+'" title="'+o.filename+'" /><p><a href="#" class="cmb_remove_file_button" rel="'+cmb.formfield+'">'+l10n.remove_image+"</a></p></div>":l10n.file+" <strong>"+o.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+o.url+'" target="_blank" rel="external">'+l10n.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+cmb.formfield+'">'+l10n.remove_file+"</a>)",r.siblings(".cmb_media_status").slideDown().html(n)}};cmb.file_frames[cmb.formfield].on("select",function(){var e=cmb.file_frames[cmb.formfield].state().get("selection"),t=c?"list":"single";m[t](e)}),cmb.file_frames[cmb.formfield].open()}},cmb.handleRemoveMedia=function(e){e.preventDefault();var t=$(this);if(t.is(".attach_list .cmb_remove_file_button"))return t.parents("li").remove(),!1;cmb.formfield=t.attr("rel");var i=t.parents(".img_status");return cmb.metabox().find("input#"+cmb.formfield).val(""),cmb.metabox().find("input#"+cmb.formfield+"_id").val(""),i.length?i.html(""):t.parents(".cmb_media_status").html(""),!1},$.fn.replaceText=function(e,t,i){return this.each(function(){var r,a,n=this.firstChild,o=[];if(n)do 3===n.nodeType&&(r=n.nodeValue,a=r.replace(e,t),a!==r&&(!i&&/</.test(a)?($(n).before(a),o.push(n)):n.nodeValue=a));while(n=n.nextSibling);o.length&&$(o).remove()})},$.fn.cleanRow=function(e,t){var i=$(this),r=i.find('input:not([type="button"]), select, textarea, label');return t&&i.find(".cmb-repeat-table .repeat-row:not(:first-child)").remove(),cmb.$focus=!1,cmb.neweditor_id=[],r.filter(":checked").removeAttr("checked"),r.filter(":selected").removeAttr("selected"),i.find(".cmb-group-title").length&&i.find(".cmb-group-title h4").text(i.data("title").replace("{#}",cmb.idNumber+1)),r.each(function(){var t,i,r=$(this),a=r.hasClass("wp-editor-area"),n=r.attr("for"),o={};if(n)o={"for":n.replace("_"+e,"_"+cmb.idNumber)};else{var c=r.attr("name"),m=c?c.replace("["+e+"]","["+cmb.idNumber+"]"):"";i=r.attr("id"),t=i?i.replace("_"+e,"_"+cmb.idNumber):"",o={id:t,name:m,"data-iterator":cmb.idNumber}}if(r.removeClass("hasDatepicker").attr(o).val(""),a){t=t?i.replace("zx"+e,"zx"+cmb.idNumber):"",r.html("");var l=r.parents(".cmb-type-wysiwyg");l.find(".mce-tinymce:not(:first-child)").remove();var s=l.html().replace(new RegExp(i,"g"),t);l.html(s),cmb.neweditor_id.push({id:t,old:i})}cmb.$focus=cmb.$focus?cmb.$focus:r}),this},$.fn.newRowHousekeeping=function(){var e=$(this),t=e.find(".wp-picker-container"),i=e.find(".cmb_media_status");return t.length&&t.each(function(){var e=$(this).parent();e.html(e.find("input:text.cmb_colorpicker").attr("style",""))}),i.length&&i.empty(),this},cmb.afterRowInsert=function(e){cmb.$focus&&cmb.$focus.focus();var t;if(cmb.neweditor_id.length){var i;for(i=cmb.neweditor_id.length-1;i>=0;i--){var r=cmb.neweditor_id[i].id,a=cmb.neweditor_id[i].old;if("undefined"==typeof tinyMCEPreInit.mceInit[r]){var n=jQuery.extend({},tinyMCEPreInit.mceInit[a]);for(t in n)"string"==typeof n[t]&&(n[t]=n[t].replace(new RegExp(a,"g"),r));tinyMCEPreInit.mceInit[r]=n}if("undefined"==typeof tinyMCEPreInit.qtInit[r]){var o=jQuery.extend({},tinyMCEPreInit.qtInit[a]);for(t in o)"string"==typeof o[t]&&(o[t]=o[t].replace(new RegExp(a,"g"),r));tinyMCEPreInit.qtInit[r]=o}tinyMCE.init({id:tinyMCEPreInit.mceInit[r]})}}cmb.initPickers(e.find("input:text.cmb_timepicker"),e.find("input:text.cmb_datepicker"),e.find("input:text.cmb_colorpicker"))},cmb.updateNameAttr=function(){var e=$(this),t=e.attr("name");if("undefined"==typeof t)return!1;var i=parseInt(e.parents(".repeatable-grouping").data("iterator")),r=i-1,a=t.replace("["+i+"]","["+r+"]");e.attr("name",a)},cmb.emptyValue=function(e,t){$('input:not([type="button"]), textarea',t).val("")},cmb.addGroupRow=function(e){e.preventDefault();var t=$(this),i=$("#"+t.data("selector")),r=i.find(".repeatable-grouping").last(),a=parseInt(r.data("iterator"));cmb.idNumber=a+1;var n=r.clone();n.data("title",t.data("grouptitle")).newRowHousekeeping().cleanRow(a,!0);var o=$('<tr class="repeatable-grouping" data-iterator="'+cmb.idNumber+'">'+n.html()+"</tr>");r.after(o),cmb.afterRowInsert(o),i.find(".repeatable-grouping").length<=1?i.find(".remove-group-row").prop("disabled",!0):i.find(".remove-group-row").removeAttr("disabled"),i.trigger("cmb_add_row",o)},cmb.addAjaxRow=function(e){e.preventDefault();var t=$(this),i="#"+t.data("selector"),r=$(i),a=r.find(".empty-row"),n=parseInt(a.find("[data-iterator]").data("iterator"));cmb.idNumber=n+1;var o=a.clone();o.newRowHousekeeping().cleanRow(n),a.removeClass("empty-row hidden").addClass("repeat-row"),a.after(o),cmb.afterRowInsert(o),r.trigger("cmb_add_row",o)},cmb.removeGroupRow=function(e){e.preventDefault();var t=$(this),i=$("#"+t.data("selector")),r=t.parents(".repeatable-grouping"),a=i.find(".repeatable-grouping").length;r.nextAll(".repeatable-grouping").find(cmb.repeatEls).each(cmb.updateNameAttr),a>1&&(r.remove(),3>a?i.find(".remove-group-row").prop("disabled",!0):i.find(".remove-group-row").prop("disabled",!1),i.trigger("cmb_remove_row"))},cmb.removeAjaxRow=function(e){e.preventDefault();var t=$(this),i=t.parents("tr"),r=t.parents(".cmb-repeat-table");r.find("tr").length>2&&(i.hasClass("empty-row")&&i.prev().addClass("empty-row").removeClass("repeat-row"),t.parents(".cmb-repeat-table tr").remove(),r.trigger("cmb_remove_row"))},cmb.shiftRows=function(e){e.preventDefault();var t=$(this),i=t.parents(".repeatable-grouping"),r=t.hasClass("move-up")?i.prev(".repeatable-grouping"):i.next(".repeatable-grouping");if(r.length){var a=[];i.find(cmb.repeatEls).each(function(){var e,t=$(this);t.hasClass("cmb_media_status")?e=t.html():"checkbox"===t.attr("type")?(e=t.is(":checked"),cmb.log("checked",e)):"select"===t.prop("tagName")?(e=t.is(":selected"),cmb.log("checked",e)):e=t.val(),a.push({val:e,$:t})}),r.find(cmb.repeatEls).each(function(e){var t,i=$(this);i.hasClass("cmb_media_status")?(t=i.html(),i.html(a[e].val),a[e].$.html(t)):"checkbox"===i.attr("type")?(a[e].$.prop("checked",i.is(":checked")),i.prop("checked",a[e].val)):"select"===i.prop("tagName")?(a[e].$.prop("selected",i.is(":selected")),i.prop("selected",a[e].val)):(a[e].$.val(i.val()),i.val(a[e].val))})}},cmb.initPickers=function(e,t,i){cmb.initTimePickers(e),cmb.initDatePickers(t),cmb.initColorPickers(i)},cmb.initTimePickers=function(e){e.length&&e.timePicker(cmb.defaults.timePicker)},cmb.initDatePickers=function(e){e.length&&(e.datepicker("destroy"),e.datepicker(),cmb.defaults.datePicker&&!$.isEmptyObject(cmb.defaults.datePicker)&&$.datepicker.setDefaults(cmb.defaults.datePicker))},cmb.initColorPickers=function(e){e.length&&("object"==typeof jQuery.wp&&"function"==typeof jQuery.wp.wpColorPicker?e.wpColorPicker(cmb.defaults.colorPicker):e.each(function(e){$(this).after('<div id="picker-'+e+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>'),$("#picker-"+e).hide().farbtastic($(this))}).focus(function(){$(this).next().show()}).blur(function(){$(this).next().hide()}))},cmb.makeListSortable=function(){cmb.metabox().find(".cmb_media_status.attach_list").sortable({cursor:"move"}).disableSelection()},cmb.maybeOembed=function(e){var t=$(this),i=e.type,r={focusout:function(){setTimeout(function(){cmb.spinner(".postbox table.cmb_metabox",!0)},2e3)},keyup:function(){var i=function(t,i){return e.which<=i&&e.which>=t};(i(48,90)||i(96,111)||i(8,9)||187===e.which||190===e.which)&&cmb.doAjax(t,e)},paste:function(){setTimeout(function(){cmb.doAjax(t)},100)}};r[i]()},cmb.resizeoEmbeds=function(){cmb.metabox().each(function(){var e=$(this),t=e.parents(".inside");if(!t.length)return!0;var i=Math.round(.82*t.width()*.97)-30;if(i>639)return!0;var r=e.find(".cmb-type-oembed .embed_status"),a=r.children().not(".cmb_remove_wrapper");return a.length?void a.each(function(){var e=$(this),t=e.width(),r=e.height(),a=i;e.parents(".repeat-row").length&&(a=i-91);var n=Math.round(a*r/t);e.width(a).height(n)}):!0})},cmb.log=function(){l10n.script_debug&&console&&"function"==typeof console.log&&console.log.apply(console,arguments)},cmb.spinner=function(e,t){t?$(".cmb-spinner",e).hide():$(".cmb-spinner",e).show()},cmb.doAjax=function(e){var t=e.val();if(!(t.length<6)){var i=e.attr("id"),r=e.parents(".cmb-repeat-table  tr td");r=r.length?r:e.parents(".cmb_metabox tr td");var a=$(".embed_status",r),n=e.width(),o=$(":first-child",a);cmb.log("oembed_url",t,i),n=a.length&&o.length?o.width():e.width(),cmb.spinner(r),$(".embed_wrap",r).html(""),setTimeout(function(){$(".cmb_oembed:focus").val()===t&&$.ajax({type:"post",dataType:"json",url:l10n.ajaxurl,data:{action:"cmb_oembed_handler",oembed_url:t,oembed_width:n>300?n:300,field_id:i,object_id:e.data("objectid"),object_type:e.data("objecttype"),cmb_ajax_nonce:l10n.ajax_nonce},success:function(e){cmb.log(e),"undefined"!=typeof e.id&&(cmb.spinner(r,!0),$(".embed_wrap",r).html(e.result))}})},500)}},$(document).ready(cmb.init),cmb}(window,document,jQuery);